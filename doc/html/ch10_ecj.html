<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CARLsim: Chapter 10: ECJ</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="CARLsimStyles.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CARLsim
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">CARLsim: a GPU-accelerated SNN simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="usergroup0.html"><span>User&#160;Guide</span></a></li>
      <li><a href="usergroup1.html"><span>Tutorial</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ch10_ecj.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Chapter 10: ECJ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ch10s1_overview">CARLsim-ECJ Parameter-Tuning Framework Overview</a></li>
<li class="level1"><a href="#ch10s2_installation">10.2 Installation</a></li>
<li class="level1"><a href="#ch10s3_usage">10.3 ECJ Usage</a></li>
<li class="level1"><a href="#ch10s4_references">References</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="ch10s1_overview"></a>
CARLsim-ECJ Parameter-Tuning Framework Overview</h1>
<p><a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> now has a software interface to an evolutionary computation system written in Java (ECJ) (Luke et al., 2006) to provide an automated parameter tuning framework. We found that an automated tuning framework became increasingly useful as our SNN models became more complex. Evolutionary Algorithms (EAs) enable flexible parameter tuning by means of optimizing a generic fitness function. The first version of the automated paramter-tuning framework used an EA library called Evolving Objects (EO) as the EA engine (Carlson et al., 2014). ECJ was chosen to supercede EO because it is under active development (Linux), supports multi-threading, has excellent documentation, and implements a variety of EAs (Luke at al., 2006).</p>
<div class="image">
<img src="10_ecj.png" alt="10_ecj.png"/>
<div class="caption">
Fig. 1. General approach to parameter tuning. ECJ performs the EA and passes the current generation of parameters (red arrow) to CARLsim for evaluation using the parameter tuning interface (PTI) code. CARLsim assigns each parameter set to an SNN and evaluates all the individuals in parallel, passing the fitness values back to ECJ for selection of individuals in the next generation (black arrow).</div></div>
<p> Source: Beyeler et al., 2015</p>
<p>Fig. 1 shows the general approach of the automated parameter tuning framework. ECJ implements an EA with a parameter file that includes: EA parameters, the number of individuals per generation, and parameter ranges. Each step of the EA is executed by ECJ except for the evaluation of the fitness function, which is completed by <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a>. <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> evaluates the fitness function in parallel by running multiple SNN individuals simultaneously on the GPU, where the bulk of the computations occur. ECJ is written in Java, which is slower than C, but the majority of the execution time is spent running CARLsimâ€™s optimized C++/CUDA code. At the beginning of every generation, the parameters to be tuned are passed from ECJ to <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> using standard input/output streams in Linux. <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> evaluates individuals in parallel and returns the resulting fitness values to ECJ via standard streams. The tuning framework allows users to tune virtually any SNN parameter, while the fitness functions can be written to depend on the neuronal activity or synaptic weights of the SNN.</p>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h1><a class="anchor" id="ch10s2_installation"></a>
10.2 Installation</h1>
<p>The current version of the <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> paramter-tuning framework uses Evolutionary Computations in Java (ECJ) (version 22 or greater is required). For information on how to install ECJ, please go <a href="http://cs.gmu.edu/~eclab/projects/ecj/">here</a>.</p>
<p>After ECJ version 22 or greater has been installed the user then needs to set the <code>ECJ_DIR</code> and <code>ECJ_PTI_DIR</code> environment variables in either the .bashrc file or the user.mk file located in the tools/ecj_pti subdirectory. The <code>ECJ_DIR</code> environment variable points to the current installation location of ECJ. The <code>ECJ_PTI_DIR</code> environment variable points to the desired location of the CARLsim-ECJ PTI code. The code below shows the default values that can be changed in the user.mk file:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#------------------------------------------------------------------------------</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># CARLsim/ECJ Parameter Tuning Interface Options</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#------------------------------------------------------------------------------</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># path of evolutionary computation in java installation for ECJ-PTI CARLsim</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># support</span></div>
<div class="line"><span class="preprocessor"></span>ECJ_DIR ?= /opt/ecj</div>
<div class="line">ECJ_PTI_DIR ?= /opt/CARL/carlsim_ecj_pti</div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>The user should note that the user.mk file in the tools/ecj_pti directory is distinct from the user.mk file in the main carlsim directory and not confuse them. Here we are configuring the user.mk file in the tools/ecj_pti subdirectory.</dd></dl>
<p>As an alternative, users can set these environment variables in their .bashrc files if they are using a Unix-like OS. The following lines would be appended to .bashrc.</p>
<div class="fragment"><div class="line">export ECJ_DIR = /opt/ecj</div>
<div class="line">export ECJ_PTI_DIR = /opt/CARL/carlsim_ecj_pti</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>You may have to open a new shell or reboot to get export these variables.</dd></dl>
<p>Once the environment variables have been set. Navigate to tools/ecj_pti and run:</p>
<div class="fragment"><div class="line">make &amp;&amp; sudo make install</div>
</div><!-- fragment --><p>This will install the CARLsim-ECJ PTI static library into the location pointed to by <code>ECJ_PTI_DIR</code>. To uninstall the CARLsim-ECJ-PTI</p>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h1><a class="anchor" id="ch10s3_usage"></a>
10.3 ECJ Usage</h1>
<p>In general, users will create their own project directory and model it after the tutorial program found in <a class="el" href="tut3_pti.html">Tutorial 3: Parameter Tuning Interface (PTI)</a>. Users configure a ECJ parameter file and implement a <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> fitness evaluation function. ECJ performs the EA utilizing the user-defined parameter file and runs the <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> 'main' program every generation to evaluate the fitness for all individuals in parallel. Each individual represents a different SNN with a unique set of parameter values. ECJ outputs the fitness and parameter files to log files every generation. Parameter values from high-fitness SNNs can then be used in SNN modeling and simulation.</p>
<p>First the ECJ configuration file must be edited. Parts of the ECJ configuration file are shown below:</p>
<div class="fragment"><div class="line">parent.0 =                              @ec.simple.SimpleEvolutionState simple.params</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Modifications to the Simple EA boiler plate</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># =========================</span></div>
<div class="line"><span class="preprocessor"></span>eval =                  ecjapp.eval.SimpleGroupedEvaluator</div>
<div class="line">generations =               50</div>
<div class="line">pop.subpop.0.size =  10</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Set up our evolutionary algorithm</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># =========================</span></div>
<div class="line"><span class="preprocessor"></span>pop.subpop.0.species =                  ec.vector.FloatVectorSpecies</div>
<div class="line">pop.subpop.0.species.pipe =             ec.vector.breed.VectorMutationPipeline</div>
<div class="line">pop.subpop.0.species.pipe.likelihood =  1.0</div>
<div class="line">pop.subpop.0.species.pipe.source.0 =    ec.vector.breed.VectorCrossoverPipeline</div>
<div class="line">pop.subpop.0.species.pipe.source.0.likelihood   = 0.9</div>
<div class="line">pop.subpop.0.species.pipe.source.0.source.0 = ec.select.TournamentSelection</div>
<div class="line"><span class="preprocessor">#pop.subpop.0.species.pipe.source.0.source.0 = ec.es.ESSelection</span></div>
<div class="line"><span class="preprocessor"></span>pop.subpop.0.species.pipe.source.0.source.1 = same</div>
<div class="line">select.tournament.size =                2</div>
<div class="line">pop.subpop.0.species.ind =              ec.vector.DoubleVectorIndividual</div>
<div class="line">pop.subpop.0.species.fitness =          ec.simple.SimpleFitness</div>
<div class="line">pop.subpop.0.species.genome-size =      4</div>
<div class="line"></div>
<div class="line">pop.subpop.0.species.min-gene =         0.0005</div>
<div class="line">pop.subpop.0.species.max-gene =         0.5</div>
<div class="line">pop.subpop.0.species.mutation-type =    gauss</div>
<div class="line">pop.subpop.0.species.mutation-stdev =   0.1</div>
<div class="line">pop.subpop.0.species.mutation-bounded = <span class="keyword">true</span></div>
<div class="line">pop.subpop.0.species.mutation-prob =    0.4</div>
<div class="line">pop.subpop.0.species.crossover-likelihood =0.4</div>
<div class="line">#pop.subpop.0.species.crossover-prob=   0.9</div>
<div class="line">pop.subpop.0.species.crossover-type =   two</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># breed options</span></div>
<div class="line"><span class="preprocessor"></span>breed =              ec.es.MuPlusLambdaBreeder</div>
<div class="line">breed.elite.0 = 1</div>
<div class="line">breed.reevaluate-elites.0 = <span class="keyword">false</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># evolution strategies options</span></div>
<div class="line"><span class="preprocessor"></span>es.mu.0 =            5</div>
<div class="line">es.lambda.0 =        5</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Termination condition</span></div>
<div class="line"><span class="preprocessor"></span>quit-on-run-complete = <span class="keyword">true</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Set up external fitness evaluation</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># =========================</span></div>
<div class="line"><span class="preprocessor"></span>eval.problem.objective.idealFitnessValue = 0.333</div>
<div class="line">eval.problem =                          ecjapp.eval.problem.CommandProblem</div>
<div class="line">eval.problem.objective =                ecjapp.eval.problem.objective.StringToDoubleObjective</div>
<div class="line">eval.problem.simulationCommand =        $carlsim_tuneFiringRatesECJ</div>
</div><!-- fragment --><p>It's probably easiest to start with this ECJ parameter file and modify it to your project's needs. The particular variables the user needs to edit are:</p>
<p><code>eval.problem.simulationCommand</code>: which is the name of the carlsim binary ECJ executes every generation to evaluate the fitness function. The $ sign means the path is relative to the location of the parameter file.</p>
<p><code>generations</code>: number of maximum generations to run.</p>
<p><code>pop.subpop.0.size</code>: number of individuals in each generation.</p>
<p><code>pop.subpop.0.species.genome-size</code>: total number of parameters to be tuned in each individual.</p>
<p><code>pop.subpop.0.species.min-gene</code>: default minimum range value for all parameters to be tuned</p>
<p><code>pop.subpop.0.species.max-gene</code>: default maximum range value for all parameters to be tuned</p>
<p>To specify the parameter range for each parameter individually, you define min-gene and max.gene values for additional pop.subpop members as is shown in the code below:</p>
<div class="fragment"><div class="line">pop.subpop.1.species.min-gene=0.0004</div>
<div class="line">pop.subpop.1.species.max-gene=0.004</div>
<div class="line">pop.subpop.2.species.min-gene=0.00005</div>
<div class="line">pop.subpop.2.species.max-gene=0.0005</div>
<div class="line">pop.subpop.3.species.min-gene=0.01</div>
<div class="line">pop.subpop.3.species.max-gene=0.1</div>
<div class="line">pop.subpop.4.species.min-gene=0.1</div>
<div class="line">pop.subpop.4.species.max-gene=0.2</div>
</div><!-- fragment --><p>However,you still need to keep the <code>pop.subpop.0.species.min-gene</code> and <code>pop.subpop.0.species.max-gene</code> in the parameter file.</p>
<p>for more information about the ECJ configuration file, please visit the ECJ <a href="http://cs.gmu.edu/~eclab/projects/ecj/">homepage</a>.</p>
<p>Users then need to implement their own <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> evaluation function. The overall structure is as follows. A specific Experiment class is implemented and inherited from the base Experiment class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>TuneFiringRatesECJExperiment : <span class="keyword">public</span> Experiment {</div>
</div><!-- fragment --><p>The only class functions functions are the default class constructor and the run function. The run function is where <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> code is written and executed. At the final step, the fitness values are output back to ECJ using standard Linux streams.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> run(<span class="keyword">const</span> ParameterInstances &amp;parameters, std::ostream &amp;outputStream)<span class="keyword"> const </span>{</div>
<div class="line">...</div>
<div class="line">CARLsim* <span class="keyword">const</span> network = <span class="keyword">new</span> <a class="code" href="classCARLsim.html">CARLsim</a>(<span class="stringliteral">&quot;tuneFiringRatesECJ&quot;</span>, <a class="code" href="carlsim__datastructures_8h.html#a14838da6840920e8872a5620470f1522a0b5ee5e90bb225a562d92e4078ad9728">GPU_MODE</a>, <a class="code" href="carlsim__datastructures_8h.html#ace95bf2edf06bd0708c106dfe43271edab9de27525b1cd54c353f4ed868a6cb26">SILENT</a>);</div>
<div class="line">...</div>
<div class="line">network-&gt;setupNetwork();</div>
<div class="line">...</div>
<div class="line">network-&gt;runNetwork(runTime,0);</div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">for(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; parameters.getNumInstances(); i++) {</div>
<div class="line">...</div>
<div class="line">outputStream &lt;&lt; fitness[i] &lt;&lt; endl;</div>
<div class="line">...</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section see"><dt>See Also</dt><dd><a class="el" href="tut3_pti.html">Tutorial 3: Parameter Tuning Interface (PTI)</a></dd></dl>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<p>References </p>
<h1><a class="anchor" id="ch10s4_references"></a>
References</h1>
<p>Beyeler, M., Carlson, K. D., Chou, T. S., Dutt, N., Krichmar, J. L., <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> 3: A user-friendly and highly optimized library for the creation of neurobiologically detailed spiking neural networks. (Submitted)</p>
<p>Carlson, K. D., Nageswaran, J. M., Dutt, N., Krichmar, J. L., An efficient automated parameter tuning framework for spiking neural networks, Front. Neurosci., vol. 8, no. 10, 2014.</p>
<p>Luke, S., Panait, L., Balan, G., Paus, S., Skolicki, Z., Bassett, J., Hubley, R., and Chircop, A., ECJ: A java-based evolutionary computation research system, <a href="http://cs">http://cs</a>. gmu. edu/eclab/projects/ecj, 2006. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Feb 17 2015 11:55:17 for CARLsim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
