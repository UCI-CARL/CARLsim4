<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CARLsim: Tutorial 5: Motion Energy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="CARLsimStyles.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CARLsim
   &#160;<span id="projectnumber">4.1.0</span>
   </div>
   <div id="projectbrief">CARLsim: a GPU-accelerated SNN simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tut5_motion_energy.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorial 5: Motion Energy </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#tut5s1_me">5.1 The MotionEnergy Library</a><ul><li class="level2"><a href="#tut5s1s1_installation">5.1.1 Installing the Library</a></li>
<li class="level2"><a href="#tut5s1s2_first_steps">5.1.2 First Steps</a></li>
</ul>
</li>
<li class="level1"><a href="#tut5s2_stimuli">5.2 Stimuli</a></li>
<li class="level1"><a href="#tut5s3_network">5.3 Network</a><ul><li class="level2"><a href="#tut5s3s1_importing">5.3.1 Importing the Stimulus</a></li>
<li class="level2"><a href="#tut5s3s2_assigning">5.3.2 Assigning Image Pixels to Neurons</a></li>
<li class="level2"><a href="#tut5s3s3_me">5.3.3 Setting up the MotionEnergy object</a></li>
<li class="level2"><a href="#tut5s3s4_setup">5.3.4 Setting up the Network</a></li>
<li class="level2"><a href="#tut5s3s5_run">5.3.5 Running the Network</a></li>
<li class="level2"><a href="#tut5s3s6_plotting">5.3.6 Visualizing the Output</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Michael Beyeler </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="ch1_getting_started.html">Chapter 1: Getting Started</a> </dd>
<dd>
<a class="el" href="ch2_basic_concepts.html">Chapter 2: Basic Concepts</a> </dd>
<dd>
<a class="el" href="ch3_neurons_synapses_groups.html">Chapter 3: Neurons, Synapses, and Groups</a> </dd>
<dd>
<a class="el" href="ch4_connections.html">Chapter 4: Connections</a> </dd>
<dd>
<a class="el" href="ch9_matlab_oat.html">Chapter 9: MATLAB Offline Analysis Toolbox (OAT)</a> </dd>
<dd>
<a class="el" href="tut4_image_processing.html">Tutorial 4: Image Processing</a></dd></dl>
<p>This tutorial will really put your <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> skills to the test, as we will combine different concepts and libraries to create a network of direction-selective neurons that are arranged on a spatial grid.</p>
<p>We will first use the <code><a class="el" href="classVisualStimulus.html" title="Class to integrate CARLsim with a stimulus created using VisualStimulus.m Version: 4/11/14 Author: Mi...">VisualStimulus</a></code> toolbox to generate a drifting sinusoidal grating. Then we will use the <code>MotionEnergy</code> library to parse the stimulus and generate direction-selective responses akin to those of neurons in the primary visual cortex (V1). These responses will then be assigned to a spike generator group, which we term V1. A second group, termed middle temporal area (MT) neurons, will then sum over V1 responses using a Gaussian kernel in space (x and y), but not direction (z).</p>
<p>At the end of the tutorial, you will know how to:</p><ul>
<li>generate a drifting sinusoidal grating using the <code>VisualStimulusToolbox</code></li>
<li>parse a stimulus using the <code>MotionEnergy</code> library</li>
<li>assign <code>MotionEnergy</code> output to <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> groups</li>
<li>use the <a class="el" href="structGrid3D.html" title="A struct to arrange neurons on a 3D grid (a primitive cubic Bravais lattice with cubic side length 1)">Grid3D</a> and <a class="el" href="structRadiusRF.html" title="A struct to specify the receptive field (RF) radius in 3 dimensions.">RadiusRF</a> structs for 2D and 3D transforms</li>
<li>create Gaussian connections for neurons arranged on a 2D/3D grid</li>
</ul>
<p>The source code of this tutorial can be found in <code>%%CARLSIM_ROOT_DIR%%/doc/source/tutorial/5_motion_energy</code>.</p>
<h1><a class="anchor" id="tut5s1_me"></a>
5.1 The MotionEnergy Library</h1>
<p>The <code>MotionEnergy</code> library provides a CUDA implementation of Simoncelli and Heeger's Motion Energy model <a href="http://dx.doi.org/10.1016/S0042-6989(97)00183-1">(Simoncelli &amp; Heeger, 1998)</a>. The code itself is based on Beyeler et al. <a href="http://dx.doi.org/10.1007/s12021-014-9220-y">(2014)</a>, and comes with both a Python and a C/C++ interface.</p>
<p>In this tutorial, we will make use of the C/C++ interface. For this, we first have to install the library.</p>
<h2><a class="anchor" id="tut5s1s1_installation"></a>
5.1.1 Installing the Library</h2>
<p>If you followed the <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> installation instructions outlined in <a class="el" href="ch1_getting_started.html">Chapter 1: Getting Started</a>, you already have the code in <code>external/MotionEnergy</code>.</p>
<p>However, if your <code>external/MotionEnergy</code> directory appears to be empty (e.g., because you forgot the <code>&ndash;recursive</code> flag when you cloned <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a>), you have to initialize the submodule yourself. Simply navigate to the <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> root directory and run the following:</p>
<div class="fragment"><div class="line">$ git submodule update --init --recursive</div>
</div><!-- fragment --><p>Then navigate to the library directory to compile and install the code.</p>
<div class="fragment"><div class="line">$ cd external/MotionEnergy/cppME</div>
<div class="line">$ make</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><p>This will install the library to <code>/opt/CARL/ME</code>. If you wish to install it in a different library, you can export an environment variable <code>ME_LIB_DIR</code> prior to compiling:</p>
<div class="fragment"><div class="line">$ cd external/MotionEnergy/cppME</div>
<div class="line">$ export ME_LIB_DIR=/path/to/your/preferred/dir</div>
<div class="line">$ make install</div>
</div><!-- fragment --><h2><a class="anchor" id="tut5s1s2_first_steps"></a>
5.1.2 First Steps</h2>
<p>You can verify the installation by running the example project:</p>
<div class="fragment"><div class="line">$ cd external/MotionEnergy/cppME/projects/hello_world</div>
<div class="line">$ make</div>
<div class="line">$ ./hello_world</div>
</div><!-- fragment --><h1><a class="anchor" id="tut5s2_stimuli"></a>
5.2 Stimuli</h1>
<p>In order to create a visual stimulus depicting a drifting sinusoidal grating, we will make use of the <code>VisualStimulusToolbox</code>.</p>
<p>If this is your first time using the toolbox, have a look at <a class="el" href="tut4_image_processing.html#tut4s1_visual_stimulus">4.1 VisualStimulusToolbox</a> to make sure it is correctly installed.</p>
<p>The easiest way to create the stimulus is to run the script <code>script/createGratingVideo.m</code>. What it does is, it creates a 32x32 pixel grating using <code>GratingStim</code>:</p>
<div class="fragment"><div class="line">&gt;&gt; initOAT</div>
<div class="line">&gt;&gt; grating = GratingStim([32 32])</div>
<div class="line"> </div>
<div class="line">grating = </div>
<div class="line"> </div>
<div class="line">  GratingStim with properties:</div>
<div class="line"> </div>
<div class="line">                  width: 32</div>
<div class="line">                 height: 32</div>
<div class="line">               channels: 1</div>
<div class="line">                 length: 0</div>
<div class="line">                   stim: []</div>
<div class="line">    supportedNoiseTypes: {<span class="stringliteral">&#39;gaussian&#39;</span>  <span class="stringliteral">&#39;localvar&#39;</span>  <span class="stringliteral">&#39;poisson&#39;</span>  <span class="stringliteral">&#39;salt &amp; pepper&#39;</span>  <span class="stringliteral">&#39;speckle&#39;</span>}</div>
</div><!-- fragment --><p>We can then add frames to empty stimulus by specifying the number of frames and the direction of motion in degrees, where 0 stands for rightward motion, 90 deg is upward, 180 deg is leftward, and 270 deg is downward. Here we want to sample the spectrum in 45 deg increments, and add 10 frames each:</p>
<div class="fragment"><div class="line">&gt;&gt; <span class="keywordflow">for</span> dir=(0:7)*45</div>
<div class="line">..    grating.add(10, dir)</div>
<div class="line">.. end</div>
</div><!-- fragment --><p>This should have added 80 frames to the object.</p>
<dl class="section note"><dt>Note</dt><dd>Check out <code>help GratingStim.add</code> to find out how to change the spatial frequency of the grating, as well as other parameters.</dd></dl>
<p>You can always have a look at what you created by using <code>plot</code>:</p>
<div class="fragment"><div class="line">&gt;&gt; grating.plot</div>
</div><!-- fragment --><div class="image">
<img src="5_stim.jpg" alt=""/>
<div class="caption">
Example frame of the drifting sinusoidal grating.</div></div>
<p>Last thing to do is save the stimulus to file:</p>
<div class="fragment"><div class="line">&gt;&gt; grating.save(<span class="stringliteral">&#39;../input/grating.dat&#39;</span>)</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Gratings aren't the only stimulus supported by the toolbox. You can also create plaids using <code>PlaidStim</code>, random dot fields using <code>DotStim</code>, drifting bars using <code>BarStim</code>, a combination of all of the above&mdash;or you can simply load a video using <code>MovieStim</code>. Check out the <a href="http://uci-carl.github.io/VisualStimulusToolbox/">documentation</a> for more!</dd></dl>
<h1><a class="anchor" id="tut5s3_network"></a>
5.3 Network</h1>
<p>Now it is time to set up the <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> network.</p>
<h2><a class="anchor" id="tut5s3s1_importing"></a>
5.3.1 Importing the Stimulus</h2>
<p>If you have worked through the previous tutorial, you should already know how to do this. The idea is to assign every pixel in the stimulus to a neuron in the spiking network. In order to preserve spatial relationships, we arrange all neurons on a grid that matches the image dimensions.</p>
<p>The stimulus is imported simply by: </p><div class="fragment"><div class="line"><a class="code" href="classVisualStimulus.html">VisualStimulus</a> stim(<span class="stringliteral">&quot;input/grating.dat&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="tut5s3s2_assigning"></a>
5.3.2 Assigning Image Pixels to Neurons</h2>
<p>We can create a <a class="el" href="structGrid3D.html" title="A struct to arrange neurons on a 3D grid (a primitive cubic Bravais lattice with cubic side length 1)">Grid3D</a> struct from the <code>stim</code> dimensions. We want to create a population of V1 neurons that is selective for eight directions of motion. For this to work, we therefore need eight neurons per pixel location (each selective for a different direction of motion). We can simply assign motion direction to the third dimension of the grid struct. Hence the right <a class="el" href="structGrid3D.html" title="A struct to arrange neurons on a 3D grid (a primitive cubic Bravais lattice with cubic side length 1)">Grid3D</a> dimensions for V1 are:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> numDir = 8;</div>
<div class="line"><a class="code" href="structGrid3D.html">Grid3D</a> gridV1(stim.getWidth(), stim.getHeight(), numDir);</div>
</div><!-- fragment --><p>We also want a grid for a population of MT neurons. We could use the same grid as for V1, but since there are more neurons in V1 than there are in MT, let's downscale the grid a bit: </p><div class="fragment"><div class="line"><a class="code" href="structGrid3D.html">Grid3D</a> gridMT(stim.getWidth()/2, stim.getHeight()/2, numDir);</div>
</div><!-- fragment --><p>So all we need to do is create groups with the above grids:</p>
<div class="fragment"><div class="line"><span class="comment">// ---------------- CONFIG STATE -------------------</span></div>
<div class="line"><span class="keywordtype">bool</span> onGPU = <span class="keyword">true</span>;</div>
<div class="line"><a class="code" href="classCARLsim.html">CARLsim</a> sim(<span class="stringliteral">&quot;me&quot;</span>, onGPU?<a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a0b5ee5e90bb225a562d92e4078ad9728">GPU_MODE</a>:<a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a729ca642c452f8a7c53df4a48f240537">CPU_MODE</a>, <a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ae2d30a195cee6b2961cc2c23ea4b520b">USER</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> gV1=sim.<a class="code" href="classCARLsim.html#a0bf4d12b0b90740faf9a2f6a4add0351">createSpikeGeneratorGroup</a>(<span class="stringliteral">&quot;V1&quot;</span>, gridV1, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line"><span class="keywordtype">int</span> gMT=sim.<a class="code" href="classCARLsim.html#a6e11c10b6b079715074d857452c42e11">createGroup</a>(<span class="stringliteral">&quot;MT&quot;</span>, gridMT, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line">sim.<a class="code" href="classCARLsim.html#aa6e1dc5ae50722ae3d693f2c963d84cd">setNeuronParameters</a>(gMT, 0.02f, 0.2f, -65.0f, 8.0f);</div>
</div><!-- fragment --><p>We also want V1 to be input to MT. MT neurons should sum over V1 neurons using a Gaussian kernel in x and y (let's say a kernel the size of 7x7 pixels), but they should not sum over z (which is the direction of motion). In this way, MT neurons will preserve the direction selectivity of their V1 inputs. Hence the correct <a class="el" href="structRadiusRF.html" title="A struct to specify the receptive field (RF) radius in 3 dimensions.">RadiusRF</a> struct has size 7x7x0:</p>
<div class="fragment"><div class="line">sim.<a class="code" href="classCARLsim.html#a30b16b93d57551dcde0559e8a4e98e27">connect</a>(gV1, gMT, <span class="stringliteral">&quot;gaussian&quot;</span>, <a class="code" href="structRangeWeight.html">RangeWeight</a>(0.02), 1.0f, <a class="code" href="structRangeDelay.html">RangeDelay</a>(1), <a class="code" href="structRadiusRF.html">RadiusRF</a>(7,7,0));</div>
</div><!-- fragment --><h2><a class="anchor" id="tut5s3s3_me"></a>
5.3.3 Setting up the MotionEnergy object</h2>
<p>The MotionEnergy object is initialized with the size of the stimulus we imported above:</p>
<div class="fragment"><div class="line">MotionEnergy me(stim.getWidth(), stim.getHeight(), stim.getChannels());</div>
</div><!-- fragment --><p>Its job is then to parse the stimulus frame-by-frame, and convert it to a float array of filter activation values. We will have exactly one filter value per neuron in the group, so it's possible to convert this activation value into spikes.</p>
<p>For this to work, we have to choose a frame duration: This means that every frame in the video is worth some number of milliseconds of simulation time, let's say 50 ms:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> frameDurMs = 50;</div>
</div><!-- fragment --><p>During this time, every neuron in the group will fire spikes according to a Poisson process (using the <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains.">PoissonRate</a> object), the mean rate of which has yet to be determined. This process will get clearer in a second, but for now let's just initialize the <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains.">PoissonRate</a> container and assign it to the V1 group:</p>
<div class="fragment"><div class="line"><a class="code" href="classPoissonRate.html">PoissonRate</a> rateV1(gridV1.N, onGPU);</div>
<div class="line">sim.<a class="code" href="classCARLsim.html#a04f52d2840105c8ccacf8d378d1695cf">setSpikeRate</a>(gV1, &amp;rateV1);</div>
</div><!-- fragment --><h2><a class="anchor" id="tut5s3s4_setup"></a>
5.3.4 Setting up the Network</h2>
<p>After all this, don't forget to call <a class="el" href="classCARLsim.html#a6d6c298c788eeb7b18a19d82a77761b3" title="build the network">CARLsim::setupNetwork</a> and set a bunch of monitors:</p>
<div class="fragment"><div class="line">sim.<a class="code" href="classCARLsim.html#a580acd7bfec3145c00014b0bd1742e2e">setConductances</a>(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ---------------- SETUP STATE -------------------</span></div>
<div class="line">sim.<a class="code" href="classCARLsim.html#a6d6c298c788eeb7b18a19d82a77761b3">setupNetwork</a>();</div>
<div class="line"> </div>
<div class="line">sim.<a class="code" href="classCARLsim.html#a1e0b4d170b65f5075f1a996554c842ab">setSpikeMonitor</a>(gV1, <span class="stringliteral">&quot;DEFAULT&quot;</span>);</div>
<div class="line">sim.<a class="code" href="classCARLsim.html#a1e0b4d170b65f5075f1a996554c842ab">setSpikeMonitor</a>(gMT, <span class="stringliteral">&quot;DEFAULT&quot;</span>);</div>
</div><!-- fragment --><p>Then we are ready to run the network.</p>
<h2><a class="anchor" id="tut5s3s5_run"></a>
5.3.5 Running the Network</h2>
<p>This is where the magic happens. We will read a frame of the stimulus movie using <code><a class="el" href="classVisualStimulus.html" title="Class to integrate CARLsim with a stimulus created using VisualStimulus.m Version: 4/11/14 Author: Mi...">VisualStimulus</a></code>, pass the frame to the <code>MotionEnergy</code> object, and assign the output to the <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains.">PoissonRate</a> object of the V1 group. Bam!</p>
<p>First, we will parse the stimulus frame-by-frame, so we'll wrap all the action in a for loop:</p>
<div class="fragment"><div class="line"><span class="comment">// ---------------- RUN STATE -------------------</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;stim.getLength(); i++) {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">    sim.<a class="code" href="classCARLsim.html#aafb2d44405c96aafe089f96ff867018d">runNetwork</a>(frameDurMs/1000, frameDurMs%1000);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Two commands remain.</p>
<p>The first is how to read the next frame of the stimulus. This logic is all contained within <code><a class="el" href="classVisualStimulus.html" title="Class to integrate CARLsim with a stimulus created using VisualStimulus.m Version: 4/11/14 Author: Mi...">VisualStimulus</a></code>, so all you need to do is simply call the <code>readFrameChar</code> repeatedly to get an array of all grayscale values in an <code>unsigned char* frame</code> array that we initialized above:</p>
<div class="fragment"><div class="line">frame = stim.readFrameChar();</div>
</div><!-- fragment --><p>This will automatically access the next frame in the queue.</p>
<p>Then we pass the frame to the MotionEnergy object. This object has methods that expose different intermediate steps of the Motion Energy model, such as the V1 linear filter response, the normalization step, and the V1 complex cell response. It is the latter that we want here:</p>
<div class="fragment"><div class="line">me.calcV1complex(frame, onGPU?rateV1.getRatePtrGPU():rateV1.getRatePtrCPU(),</div>
<div class="line">    speed, onGPU);</div>
</div><!-- fragment --><p>This method takes a <code>frame</code>, processes it, and returns an array of filter values that gets written to the <code>rateV1</code> container. Now, because all computations are performed on the GPU, it would be silly to copy the result from the GPU to the CPU, only to find out that the <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains.">PoissonRate</a> object also lives on the GPU&mdash;so we have to copy all data back. Instead, we want to pass the right pointer (<code>rateV1.getRatePtrGPU()</code> if the <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains.">PoissonRate</a> object was allocated on the GPU), and indicate that this is a pointer to device memory (using <code>onGPU</code> set to true).</p>
<p>And that's it!</p>
<h2><a class="anchor" id="tut5s3s6_plotting"></a>
5.3.6 Visualizing the Output</h2>
<p>You can compile and run the above network as follows:</p>
<div class="fragment"><div class="line">$ make motion_energy</div>
<div class="line">$ ./motion_energy</div>
</div><!-- fragment --><p>The result can then be analyzed using the OAT. Visualizing network activity is easiest with the NetworkMonitor. Go back to the <code>scripts</code> folder in MATLAB, and run:</p>
<div class="fragment"><div class="line">&gt;&gt; demoOAT</div>
</div><!-- fragment --><p>This script will first plot all network activity as heat maps:</p>
<div class="image">
<img src="5_heat.jpg" alt=""/>
<div class="caption">
Network activity as heat maps</div></div>
<p>Here you can see group activity for V1 and MT over time. You can see hotspots of activity, which tends to run over the image from left to rigth as time moves on. The 8 "blobs" or subpopulations you see correspond to the 8 subpopulations of neurons we created above. Within these 8 subpopulations, we have all pixels of a stimulus frame represented, each pixel location encoded by a neuron. Thus the 8 subpopulations you see correspond to a 32x32 slice through the 32x32x8 grid of neurons.</p>
<p>As the drifting direction of the grating changes, so do the hotspots of activity. This is easiest to visualize using a flow field: Since we have 8 neurons coding for 8 different directions at each pixel location, we can use population vector decoding to find the net vector of motion that these 8 neurons encode. This is the second plot produced by the script:</p>
<div class="image">
<img src="5_flow.jpg" alt=""/>
<div class="caption">
Network activity as a flow field</div></div>
<p>This should make things much clearer: As time moves on, the direction of motion judgment of the neurons changes as well. You can also see that V1 activity tends to be noisier, whereas the Gaussian smoothing performed by the MT population makes the motion appear much more coherent.</p>
<dl class="section note"><dt>Note</dt><dd>In these plots, the angle of the vectors stands for direction of motion, and the length of the vectors stands for confidence in direction judgment, not speed as is common in optic flow fields. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="acarlsim__datastructures_8h_html_a625c4eced5cd956404990e73f3950258a0b5ee5e90bb225a562d92e4078ad9728"><div class="ttname"><a href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a0b5ee5e90bb225a562d92e4078ad9728">GPU_MODE</a></div><div class="ttdeci">@ GPU_MODE</div><div class="ttdoc">model is run on GPU card(s)</div><div class="ttdef"><b>Definition:</b> <a href="carlsim__datastructures_8h_source.html#l00115">carlsim_datastructures.h:115</a></div></div>
<div class="ttc" id="aclassCARLsim_html_a0bf4d12b0b90740faf9a2f6a4add0351"><div class="ttname"><a href="classCARLsim.html#a0bf4d12b0b90740faf9a2f6a4add0351">CARLsim::createSpikeGeneratorGroup</a></div><div class="ttdeci">int createSpikeGeneratorGroup(const std::string &amp;grpName, int nNeur, int neurType, int preferredPartition=ANY, ComputingBackend preferredBackend=CPU_CORES)</div><div class="ttdoc">creates a spike generator group</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8cpp_source.html#l01779">carlsim.cpp:1779</a></div></div>
<div class="ttc" id="astructRangeWeight_html"><div class="ttname"><a href="structRangeWeight.html">RangeWeight</a></div><div class="ttdoc">a range struct for synaptic weight magnitudes</div><div class="ttdef"><b>Definition:</b> <a href="carlsim__datastructures_8h_source.html#l00311">carlsim_datastructures.h:311</a></div></div>
<div class="ttc" id="aclassCARLsim_html_aafb2d44405c96aafe089f96ff867018d"><div class="ttname"><a href="classCARLsim.html#aafb2d44405c96aafe089f96ff867018d">CARLsim::runNetwork</a></div><div class="ttdeci">int runNetwork(int nSec, int nMsec=0, bool printRunSummary=true)</div><div class="ttdoc">run the simulation for time=(nSec*seconds + nMsec*milliseconds)</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8cpp_source.html#l01909">carlsim.cpp:1909</a></div></div>
<div class="ttc" id="aclassCARLsim_html_a580acd7bfec3145c00014b0bd1742e2e"><div class="ttname"><a href="classCARLsim.html#a580acd7bfec3145c00014b0bd1742e2e">CARLsim::setConductances</a></div><div class="ttdeci">void setConductances(bool isSet)</div><div class="ttdoc">Sets default values for conduction decay and rise times or disables COBA alltogether.</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8cpp_source.html#l01788">carlsim.cpp:1788</a></div></div>
<div class="ttc" id="aclassVisualStimulus_html"><div class="ttname"><a href="classVisualStimulus.html">VisualStimulus</a></div><div class="ttdoc">Class to integrate CARLsim with a stimulus created using VisualStimulus.m Version: 4/11/14 Author: Mi...</div><div class="ttdef"><b>Definition:</b> <a href="visual__stimulus_8h_source.html#l00056">visual_stimulus.h:56</a></div></div>
<div class="ttc" id="aclassPoissonRate_html"><div class="ttname"><a href="classPoissonRate.html">PoissonRate</a></div><div class="ttdoc">Class for generating Poisson spike trains.</div><div class="ttdef"><b>Definition:</b> <a href="poisson__rate_8h_source.html#l00084">poisson_rate.h:84</a></div></div>
<div class="ttc" id="acarlsim__definitions_8h_html_a71b1b059a7ff0783d39e22b9b1028d90"><div class="ttname"><a href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a></div><div class="ttdeci">#define EXCITATORY_NEURON</div><div class="ttdef"><b>Definition:</b> <a href="carlsim__definitions_8h_source.html#l00077">carlsim_definitions.h:76</a></div></div>
<div class="ttc" id="acarlsim__datastructures_8h_html_a3a04fc42e22f436d2b3809236cb6ec54ae2d30a195cee6b2961cc2c23ea4b520b"><div class="ttname"><a href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ae2d30a195cee6b2961cc2c23ea4b520b">USER</a></div><div class="ttdeci">@ USER</div><div class="ttdoc">User mode, for experiment-oriented simulations.</div><div class="ttdef"><b>Definition:</b> <a href="carlsim__datastructures_8h_source.html#l00091">carlsim_datastructures.h:91</a></div></div>
<div class="ttc" id="aclassCARLsim_html_a04f52d2840105c8ccacf8d378d1695cf"><div class="ttname"><a href="classCARLsim.html#a04f52d2840105c8ccacf8d378d1695cf">CARLsim::setSpikeRate</a></div><div class="ttdeci">void setSpikeRate(int grpId, PoissonRate *spikeRate, int refPeriod=1)</div><div class="ttdoc">Sets a spike rate.</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8cpp_source.html#l01982">carlsim.cpp:1982</a></div></div>
<div class="ttc" id="aclassCARLsim_html_a6d6c298c788eeb7b18a19d82a77761b3"><div class="ttname"><a href="classCARLsim.html#a6d6c298c788eeb7b18a19d82a77761b3">CARLsim::setupNetwork</a></div><div class="ttdeci">void setupNetwork()</div><div class="ttdoc">build the network</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8cpp_source.html#l01914">carlsim.cpp:1914</a></div></div>
<div class="ttc" id="astructRangeDelay_html"><div class="ttname"><a href="structRangeDelay.html">RangeDelay</a></div><div class="ttdoc">a range struct for synaptic delays</div><div class="ttdef"><b>Definition:</b> <a href="carlsim__datastructures_8h_source.html#l00278">carlsim_datastructures.h:278</a></div></div>
<div class="ttc" id="aclassCARLsim_html_aa6e1dc5ae50722ae3d693f2c963d84cd"><div class="ttname"><a href="classCARLsim.html#aa6e1dc5ae50722ae3d693f2c963d84cd">CARLsim::setNeuronParameters</a></div><div class="ttdeci">void setNeuronParameters(int grpId, float izh_a, float izh_a_sd, float izh_b, float izh_b_sd, float izh_c, float izh_c_sd, float izh_d, float izh_d_sd)</div><div class="ttdoc">Sets Izhikevich params a, b, c, and d with as mean +- standard deviation.</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8cpp_source.html#l01815">carlsim.cpp:1815</a></div></div>
<div class="ttc" id="acarlsim__datastructures_8h_html_a625c4eced5cd956404990e73f3950258a729ca642c452f8a7c53df4a48f240537"><div class="ttname"><a href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a729ca642c452f8a7c53df4a48f240537">CPU_MODE</a></div><div class="ttdeci">@ CPU_MODE</div><div class="ttdoc">model is run on CPU core(s)</div><div class="ttdef"><b>Definition:</b> <a href="carlsim__datastructures_8h_source.html#l00114">carlsim_datastructures.h:114</a></div></div>
<div class="ttc" id="aclassCARLsim_html"><div class="ttname"><a href="classCARLsim.html">CARLsim</a></div><div class="ttdoc">CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8h_source.html#l00137">carlsim.h:137</a></div></div>
<div class="ttc" id="aclassCARLsim_html_a30b16b93d57551dcde0559e8a4e98e27"><div class="ttname"><a href="classCARLsim.html#a30b16b93d57551dcde0559e8a4e98e27">CARLsim::connect</a></div><div class="ttdeci">short int connect(int grpId1, int grpId2, const std::string &amp;connType, const RangeWeight &amp;wt, float connProb, const RangeDelay &amp;delay=RangeDelay(1), const RadiusRF &amp;radRF=RadiusRF(-1.0), bool synWtType=SYN_FIXED, float mulSynFast=1.0f, float mulSynSlow=1.0f)</div><div class="ttdoc">Connects a presynaptic to a postsynaptic group using fixed/plastic weights and a range of delay value...</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8cpp_source.html#l01739">carlsim.cpp:1739</a></div></div>
<div class="ttc" id="astructGrid3D_html"><div class="ttname"><a href="structGrid3D.html">Grid3D</a></div><div class="ttdoc">A struct to arrange neurons on a 3D grid (a primitive cubic Bravais lattice with cubic side length 1)</div><div class="ttdef"><b>Definition:</b> <a href="carlsim__datastructures_8h_source.html#l00489">carlsim_datastructures.h:489</a></div></div>
<div class="ttc" id="aclassCARLsim_html_a1e0b4d170b65f5075f1a996554c842ab"><div class="ttname"><a href="classCARLsim.html#a1e0b4d170b65f5075f1a996554c842ab">CARLsim::setSpikeMonitor</a></div><div class="ttdeci">SpikeMonitor * setSpikeMonitor(int grpId, const std::string &amp;fileName)</div><div class="ttdoc">Sets a Spike Monitor for a groups, prints spikes to binary file.</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8cpp_source.html#l01972">carlsim.cpp:1972</a></div></div>
<div class="ttc" id="astructRadiusRF_html"><div class="ttname"><a href="structRadiusRF.html">RadiusRF</a></div><div class="ttdoc">A struct to specify the receptive field (RF) radius in 3 dimensions.</div><div class="ttdef"><b>Definition:</b> <a href="carlsim__datastructures_8h_source.html#l00363">carlsim_datastructures.h:363</a></div></div>
<div class="ttc" id="aclassCARLsim_html_a6e11c10b6b079715074d857452c42e11"><div class="ttname"><a href="classCARLsim.html#a6e11c10b6b079715074d857452c42e11">CARLsim::createGroup</a></div><div class="ttdeci">int createGroup(const std::string &amp;grpName, int nNeur, int neurType, int preferredPartition=ANY, ComputingBackend preferredBackend=CPU_CORES)</div><div class="ttdoc">creates a group of Izhikevich spiking neurons</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8cpp_source.html#l01763">carlsim.cpp:1763</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Jul 11 2020 19:24:13 for CARLsim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
