<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CARLsim: Chapter 10: ECJ</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="CARLsimStyles.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CARLsim
   &#160;<span id="projectnumber">4.1.0</span>
   </div>
   <div id="projectbrief">CARLsim: a GPU-accelerated SNN simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ch10_ecj.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Chapter 10: ECJ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ch10s1_overview">CARLsim-ECJ Parameter-Tuning Framework Overview</a></li>
<li class="level1"><a href="#ch10s2_installation">10.2 Installation</a></li>
<li class="level1"><a href="#ch10s3_usage">10.3 ECJ Usage</a></li>
<li class="level1"><a href="#ch10s4_references">References</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="ch10s1_overview"></a>
CARLsim-ECJ Parameter-Tuning Framework Overview</h1>
<p><a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> now has a software interface to an evolutionary computation system written in Java (ECJ) (Luke et al., 2006) to provide an automated parameter tuning framework. We found that an automated tuning framework became increasingly useful as our <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality.">SNN</a> models became more complex. Evolutionary Algorithms (EAs) enable flexible parameter tuning by means of optimizing a generic fitness function. The first version of the automated paramter-tuning framework used an EA library called Evolving Objects (EO) as the EA engine (Carlson et al., 2014). ECJ was chosen to supercede EO because it is under active development (Linux), supports multi-threading, has excellent documentation, and implements a variety of EAs (Luke at al., 2006).</p>
<div class="image">
<img src="10_ecj.png" alt=""/>
<div class="caption">
Fig. 1. General approach to parameter tuning. ECJ performs the EA and passes the current generation of parameters (red arrow) to CARLsim for evaluation using the parameter tuning interface (PTI) code. CARLsim assigns each parameter set to an SNN and evaluates all the individuals in parallel, passing the fitness values back to ECJ for selection of individuals in the next generation (black arrow).</div></div>
<p>Source: Beyeler et al., 2015</p>
<p>Fig. 1 shows the general approach of the automated parameter tuning framework. ECJ implements an EA with a parameter file that includes: EA parameters, the number of individuals per generation, and parameter ranges. Each step of the EA is executed by ECJ except for the evaluation of the fitness function, which is completed by <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a>. <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> evaluates the fitness function in parallel by running multiple <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality.">SNN</a> individuals simultaneously on the GPU, where the bulk of the computations occur. ECJ is written in Java, which is slower than C, but the majority of the execution time is spent running CARLsimâ€™s optimized C++/CUDA code. At the beginning of every generation, the parameters to be tuned are passed from ECJ to <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> using standard input/output streams in Linux. <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> evaluates individuals in parallel and returns the resulting fitness values to ECJ via standard streams. The tuning framework allows users to tune virtually any <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality.">SNN</a> parameter, while the fitness functions can be written to depend on the neuronal activity or synaptic weights of the <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality.">SNN</a>.</p>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h1><a class="anchor" id="ch10s2_installation"></a>
10.2 Installation</h1>
<p>The current version of the <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> paramter-tuning framework uses Evolutionary Computations in Java (ECJ) (tested using version 23). For information on how to install ECJ, please go <a href="http://cs.gmu.edu/~eclab/projects/ecj/">here</a>.</p>
<p>After ECJ has been installed, the user then needs to set the <code>ECJ_DIR</code> and <code>ECJ_PTI_DIR</code> environment variables in the ~/.bashrc file. The <code>ECJ_DIR</code> environment variable points to the ECJ installation .jar file (it should be inside a directory named jar and named as ecj.xx.jar). The <code>ECJ_PTI_DIR</code> environment variable points to the desired installation location of the CARLsim-ECJ PTI library.</p>
<p>We will also need to install apache ant (tested version is 1.9.6). Download the ant binary from <a href="https://archive.apache.org/dist/ant/binaries/">ant archive</a> and extract it.</p>
<p>Users can set these environment variable in their ~/.bashrc file. The following example lines would be appended to .bashrc. For mac OS, these variables are placed in ~/.bash_profile.</p>
<div class="fragment"><div class="line">export ECJ_JAR=/path to the ecj directory/jar/ecj.23.jar</div>
<div class="line">export ECJ_PTI_DIR=/path-to-carlsim4-installtion/carlsim_ecj_pti</div>
<div class="line"> </div>
<div class="line">export ANT_HOME=/path to apache-ant-1.9.6 directory</div>
<div class="line">export PATH=$PATH:$ANT_HOME/bin</div>
<div class="line">export CLASSPATH=.:$ANT_HOME/lib<span class="comment">/*</span></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>You may have to open a new shell or reboot to get export these variables.</dd></dl>
<p>Once the environment variables have been set. Navigate to tools/ecj_pti and run:</p>
<div class="fragment"><div class="line">make</div>
<div class="line">make install</div>
</div><!-- fragment --><p>This will install the CARLsim-ECJ PTI static library into the location pointed to by <code>ECJ_PTI_DIR</code>.</p>
<p>If you have already installed gtest in the CARLsim4 source tree, you can run the unit tests for CARLsim-ECJ PTI's C++ components, as: </p><div class="fragment"><div class="line">cd test</div>
<div class="line">make</div>
<div class="line">./pti_test </div>
</div><!-- fragment --><p>Also navigate to the doc/source/tutorial/7_pti directory and try that example to verify installation. More on this in <a class="el" href="tut7_pti.html">Tutorial 7: Parameter Tuning Interface (PTI)</a>.</p>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h1><a class="anchor" id="ch10s3_usage"></a>
10.3 ECJ Usage</h1>
<p>In general, users will create their own project directory and model it after the tutorial program found in tut5_pti. Users configure a ECJ parameter file and implement a <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> fitness evaluation function. ECJ performs the EA utilizing the user-defined parameter file and runs the <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> 'main' program every generation to evaluate the fitness for all individuals in parallel. Each individual represents a different <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality.">SNN</a> with a unique set of parameter values. ECJ outputs the fitness and parameter files to log files every generation. Parameter values from high-fitness SNNs can then be used in <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality.">SNN</a> modeling and simulation.</p>
<p>First the ECJ configuration file must be edited. Parts of the ECJ configuration file are shown below:</p>
<div class="fragment"><div class="line">parent.0 =                              @ec.simple.SimpleEvolutionState simple.params</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Modifications to the Simple EA boiler plate</span></div>
<div class="line"><span class="preprocessor"># =========================</span></div>
<div class="line">eval =                  ecjapp.eval.SimpleGroupedEvaluator</div>
<div class="line">generations =               50</div>
<div class="line">pop.subpop.0.size =  10</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Set up our evolutionary algorithm</span></div>
<div class="line"><span class="preprocessor"># =========================</span></div>
<div class="line">pop.subpop.0.species =                  ec.vector.FloatVectorSpecies</div>
<div class="line">pop.subpop.0.species.pipe =             ec.vector.breed.VectorMutationPipeline</div>
<div class="line">pop.subpop.0.species.pipe.likelihood =  1.0</div>
<div class="line">pop.subpop.0.species.pipe.source.0 =    ec.vector.breed.VectorCrossoverPipeline</div>
<div class="line">pop.subpop.0.species.pipe.source.0.likelihood   = 0.9</div>
<div class="line">pop.subpop.0.species.pipe.source.0.source.0 = ec.select.TournamentSelection</div>
<div class="line"><span class="preprocessor">#pop.subpop.0.species.pipe.source.0.source.0 = ec.es.ESSelection</span></div>
<div class="line">pop.subpop.0.species.pipe.source.0.source.1 = same</div>
<div class="line">select.tournament.size =                2</div>
<div class="line">pop.subpop.0.species.ind =              ec.vector.DoubleVectorIndividual</div>
<div class="line">pop.subpop.0.species.fitness =          ec.simple.SimpleFitness</div>
<div class="line">pop.subpop.0.species.genome-size =      4</div>
<div class="line"> </div>
<div class="line">pop.subpop.0.species.min-gene =         0.0005</div>
<div class="line">pop.subpop.0.species.max-gene =         0.5</div>
<div class="line">pop.subpop.0.species.mutation-type =    gauss</div>
<div class="line">pop.subpop.0.species.mutation-stdev =   0.1</div>
<div class="line">pop.subpop.0.species.mutation-bounded = <span class="keyword">true</span></div>
<div class="line">pop.subpop.0.species.mutation-prob =    0.4</div>
<div class="line">pop.subpop.0.species.crossover-likelihood =0.4</div>
<div class="line">#pop.subpop.0.species.crossover-prob=   0.9</div>
<div class="line">pop.subpop.0.species.crossover-type =   two</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># breed options</span></div>
<div class="line">breed =              ec.es.MuPlusLambdaBreeder</div>
<div class="line">breed.elite.0 = 1</div>
<div class="line">breed.reevaluate-elites.0 = <span class="keyword">false</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># evolution strategies options</span></div>
<div class="line">es.mu.0 =            5</div>
<div class="line">es.lambda.0 =        5</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Termination condition</span></div>
<div class="line">quit-on-run-complete = <span class="keyword">true</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Set up external fitness evaluation</span></div>
<div class="line"><span class="preprocessor"># =========================</span></div>
<div class="line">eval.problem.objective.idealFitnessValue = 0.333</div>
<div class="line">eval.problem =                          ecjapp.eval.problem.CommandProblem</div>
<div class="line">eval.problem.objective =                ecjapp.eval.problem.objective.StringToDoubleObjective</div>
<div class="line">eval.problem.simulationCommand =        $carlsim_tuneFiringRatesECJ</div>
</div><!-- fragment --><p>It's probably easiest to start with this ECJ parameter file and modify it to your project's needs. The particular variables the user needs to edit are:</p>
<p><code>eval.problem.simulationCommand</code>: which is the name of the carlsim binary ECJ executes every generation to evaluate the fitness function. The $ sign means the path is relative to the location of the parameter file.</p>
<p><code>generations</code>: number of maximum generations to run.</p>
<p><code>pop.subpop.0.size</code>: number of individuals in each generation.</p>
<p><code>pop.subpop.0.species.genome-size</code>: total number of parameters to be tuned in each individual.</p>
<p><code>pop.subpop.0.species.min-gene</code>: default minimum range value for all parameters to be tuned</p>
<p><code>pop.subpop.0.species.max-gene</code>: default maximum range value for all parameters to be tuned</p>
<p>To specify the parameter range for each parameter individually, you define min-gene and max.gene values for additional pop.subpop members as is shown in the code below:</p>
<div class="fragment"><div class="line">pop.subpop.0.species.min-gene.0=0.0004</div>
<div class="line">pop.subpop.0.species.max-gene.0=0.004</div>
<div class="line">pop.subpop.0.species.min-gene.1=0.00005</div>
<div class="line">pop.subpop.0.species.max-gene.1=0.0005</div>
<div class="line">pop.subpop.0.species.min-gene.2=0.01</div>
<div class="line">pop.subpop.0.species.max-gene.2=0.1</div>
<div class="line">pop.subpop.0.species.min-gene.3=0.1</div>
<div class="line">pop.subpop.0.species.max-gene.3=0.2</div>
</div><!-- fragment --><p>However,you still need to keep the <code>pop.subpop.0.species.min-gene</code> and <code>pop.subpop.0.species.max-gene</code> in the parameter file.</p>
<p>for more information about the ECJ configuration file, please visit the ECJ <a href="http://cs.gmu.edu/~eclab/projects/ecj/">homepage</a>.</p>
<p>Users then need to implement their own <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> evaluation function. The overall structure is as follows. A specific Experiment class is implemented and inherited from the base Experiment class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>TuneFiringRatesECJExperiment : <span class="keyword">public</span> Experiment {</div>
</div><!-- fragment --><p>The only class functions functions are the default class constructor and the run function. The run function is where <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> code is written and executed. At the final step, the fitness values are output back to ECJ using standard Linux streams.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> run(<span class="keyword">const</span> ParameterInstances &amp;parameters, std::ostream &amp;outputStream)<span class="keyword"> const </span>{</div>
<div class="line">...</div>
<div class="line">CARLsim* <span class="keyword">const</span> network = <span class="keyword">new</span> <a class="code" href="classCARLsim.html">CARLsim</a>(<span class="stringliteral">&quot;tuneFiringRatesECJ&quot;</span>, <a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a0b5ee5e90bb225a562d92e4078ad9728">GPU_MODE</a>, <a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ab9de27525b1cd54c353f4ed868a6cb26">SILENT</a>);</div>
<div class="line">...</div>
<div class="line">network-&gt;setupNetwork();</div>
<div class="line">...</div>
<div class="line">network-&gt;runNetwork(runTime,0);</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">for(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; parameters.getNumInstances(); i++) {</div>
<div class="line">...</div>
<div class="line">outputStream &lt;&lt; fitness[i] &lt;&lt; endl;</div>
<div class="line">...</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="tut7_pti.html">Tutorial 7: Parameter Tuning Interface (PTI)</a></dd></dl>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<p>References </p>
<h1><a class="anchor" id="ch10s4_references"></a>
References</h1>
<p>Beyeler, M., Carlson, K. D., Chou, T. S., Dutt, N., Krichmar, J. L., <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> 3: A user-friendly and highly optimized library for the creation of neurobiologically detailed spiking neural networks. (Submitted)</p>
<p>Carlson, K. D., Nageswaran, J. M., Dutt, N., Krichmar, J. L., An efficient automated parameter tuning framework for spiking neural networks, Front. Neurosci., vol. 8, no. 10, 2014.</p>
<p>Luke, S., Panait, L., Balan, G., Paus, S., Skolicki, Z., Bassett, J., Hubley, R., and Chircop, A., ECJ: A java-based evolutionary computation research system, <a href="http://cs">http://cs</a>. gmu. edu/eclab/projects/ecj, 2006. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="acarlsim__datastructures_8h_html_a625c4eced5cd956404990e73f3950258a0b5ee5e90bb225a562d92e4078ad9728"><div class="ttname"><a href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a0b5ee5e90bb225a562d92e4078ad9728">GPU_MODE</a></div><div class="ttdeci">@ GPU_MODE</div><div class="ttdoc">model is run on GPU card(s)</div><div class="ttdef"><b>Definition:</b> <a href="carlsim__datastructures_8h_source.html#l00115">carlsim_datastructures.h:115</a></div></div>
<div class="ttc" id="aclassCARLsim_html"><div class="ttname"><a href="classCARLsim.html">CARLsim</a></div><div class="ttdoc">CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...</div><div class="ttdef"><b>Definition:</b> <a href="carlsim_8h_source.html#l00137">carlsim.h:137</a></div></div>
<div class="ttc" id="acarlsim__datastructures_8h_html_a3a04fc42e22f436d2b3809236cb6ec54ab9de27525b1cd54c353f4ed868a6cb26"><div class="ttname"><a href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ab9de27525b1cd54c353f4ed868a6cb26">SILENT</a></div><div class="ttdeci">@ SILENT</div><div class="ttdoc">Silent mode, no output is generated.</div><div class="ttdef"><b>Definition:</b> <a href="carlsim__datastructures_8h_source.html#l00094">carlsim_datastructures.h:94</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Jul 11 2020 19:24:13 for CARLsim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
